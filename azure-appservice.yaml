name: bing-grounding-api
metadata:
  template: bing-grounding-api@0.0.1-beta

infra:
  provider: bicep
  path: infra
  module: main-appservice.bicep

# Root-level hooks run for ALL azd commands
hooks:
  preprovision:
    windows:
      shell: pwsh
      run: python scripts/preprovision_read_model_config.py ; python scripts/preprovision_purge_soft_deleted.py ; python scripts/preprovision_check_resource_group.py ; python scripts/preprovision_register_providers.py ; python scripts/preprovision_select_bing_resource.py
      continueOnError: false
      interactive: true
    posix:
      shell: sh
      run: python scripts/preprovision_read_model_config.py && python scripts/preprovision_purge_soft_deleted.py && python scripts/preprovision_check_resource_group.py && python scripts/preprovision_register_providers.py && python scripts/preprovision_select_bing_resource.py
      continueOnError: false
      interactive: true
  postprovision:
    windows:
      shell: pwsh
      run: python scripts/postprovision_deploy_models.py ; python scripts/postprovision_deploy_bing_connection.py ; python scripts/postprovision_create_agents.py
      continueOnError: false
      interactive: false
    posix:
      shell: sh
      run: python scripts/postprovision_deploy_models.py && python scripts/postprovision_deploy_bing_connection.py && python scripts/postprovision_create_agents.py
      continueOnError: false
      interactive: false

services:
  api:
    project: .
    language: py
    host: appservice
    hooks:
      postdeploy:
        windows:
          shell: pwsh
          run: python scripts/postdeploy_configure_appservice.py ; python scripts/postprovision_configure_mcp.py
          continueOnError: false
          interactive: true
        posix:
          shell: sh
          run: python scripts/postdeploy_configure_appservice.py && python scripts/postprovision_configure_mcp.py
          continueOnError: false
          interactive: true
